<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="./css/weui.min.css">
    <link rel="stylesheet" href="./css/jquery-weui.min.css">
    <link rel="stylesheet" href="./css/iconfont.css">
    <!-- 字体基准 -->
    <script src="./js/base.js"></script>
    <title>活动列表</title>
    <style>
        body,
        html {
            height: 100%;
            -webkit-tap-highlight-color: transparent;
            background-color: #f5f5f5;
        }
        
        .weui-navbar .weui-navbar__item {
            font-size: 0.3rem;
            color: #626262;
            background-color: #f5f5f5;
            padding: 0.3rem 0;
        }
        
        .weui-navbar__item.weui-bar__item--on {
            color: black;
            background-color: white;
        }
        
        .weui-navbar:after {
            border: none
        }
        
        .hd-li {
            margin-bottom: 0.2rem;
            background-color: white;
            font-size: 0.3rem;
        }
        
        .hd-li .icon-huodong {
            position: relative;
            font-size: 0.3rem;
        }
        
        .hd-li .icon-huodong::before {
            position: absolute;
            left: -0.6rem;
            top: -0.3rem;
            font-size: 0.8rem;
            color: #69c1ff;
        }
        
        .weui-media-box {
            padding: 0.3rem 0.3rem 0.15rem 0.6rem;
        }
        
        .weui-media-box::before {
            border: none;
        }
        
        .weui-panel {
            background-color: transparent;
        }
        
        .weui-panel::before {
            border: none;
        }
        
        .weui-panel::after {
            border: none;
        }
        
        .weui-pull-to-refresh__layer {
            font-size: 0.3rem;
            padding: 0.3rem 0;
            height: auto;
            line-height: 1;
            background-color: white;
        }
        
        .weui-navbar+.weui-tab__bd {
            padding-top: 1rem
        }
        
        .weui-tab__bd-item {
            width: 100%;
        }
        
        .hd-li .time {
            margin-top: 0.15rem;
            float: left;
            font-size: 0.3rem
        }
        
        .hd-li .weui-media-box__title {
            font-size: 0.3rem
        }
        
        .hd-li .action {
            float: right;
            max-width: 2.5rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            margin-top: 0.08rem;
        }
        
        .hd-li .address {
            padding: 0.15rem 0.3rem 0.3rem 0.6rem;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            border-top: 1px solid #f5f5f5;
        }
        
        .weui-toast--text {
            font-size: 0.3rem
        }
        
        .weui-loadmore {
            display: none;
            font-size: 0.3rem;
            padding: 0.3rem 0.3rem 0.6rem 0.3rem;
        }
        
        .weui-nomore {
            text-align: center;
            font-size: 0.3rem;
            padding: 0.3rem 0.3rem 1.2rem 0.3rem;
            display: none;
        }
        .add-hd-bt-box {
            position: fixed;
            bottom: 0.2rem;
            width: 100%;
        }
        
        .add-hd {
            width: 90%;
            margin: 0 auto;
            font-size: 0.3rem;
            background-color: #69c1ff;
        }
        .weui-btn_primary:not(.weui-btn_disabled):active {
            color: hsla(0, 0%, 100%, .6);
            background-color: #0979c9
        }
    </style>
</head>

<body ontouchstart>
    <div class="weui-tab">
        <div class="weui-navbar">
            <div class="weui-navbar__item weui-bar__item--on" href="#tab1">
                全部
            </div>
            <div class="weui-navbar__item" href="#tab2">
                进行中
            </div>
            <div class="weui-navbar__item" href="#tab3">
                已结束
            </div>
        </div>
        <div class="weui-tab__bd">
            <div id="tab1" class="weui-tab__bd-item weui-tab__bd-item--active weui-pull-to-refresh infinite">
                <div class="weui-pull-to-refresh__layer">
                    <div class='weui-pull-to-refresh__arrow'></div>
                    <div class='weui-pull-to-refresh__preloader'></div>
                    <div class="down">下拉刷新</div>
                    <div class="up">释放刷新</div>
                    <div class="refresh">正在刷新</div>
                </div>
                <div class="content-padded">
                    <div class="weui-panel weui-panel_access">
                        <div class="weui-panel__bd">
                            <div class="hd-li">
                                <a href="hd-detail.html" class="weui-media-box weui-media-box_appmsg">
                                    <div class="weui-media-box__bd iconfont icon-huodong">
                                        <h4 class="weui-media-box__title">水电费看见垃圾地方大型互动</h4>
                                        <p class="weui-media-box__desc time">2018-05-23-2018-09-15</p>
                                        <div class="action">执行人：你好12321223</div>
                                    </div>
                                </a>
                                <div class="address">活动地址：居然之家as sd sadsa sd阿萨德按时阿萨德</div>
                            </div>
                            <div class="hd-li">
                                <a href="javascript:void(0);" class="weui-media-box weui-media-box_appmsg">
                                    <div class="weui-media-box__bd iconfont icon-huodong">
                                        <h4 class="weui-media-box__title">水电费看见垃圾地方大型互动</h4>
                                        <p class="weui-media-box__desc time">2018-05-23-2018-09-15</p>
                                        <div class="action">执行人：你好12321223</div>
                                    </div>
                                </a>
                                <div class="address">活动地址：居然之家</div>
                            </div>
                            <div class="hd-li">
                                <a href="javascript:void(0);" class="weui-media-box weui-media-box_appmsg">
                                    <div class="weui-media-box__bd iconfont icon-huodong">
                                        <h4 class="weui-media-box__title">水电费看见垃圾地方大型互动</h4>
                                        <p class="weui-media-box__desc time">2018-05-23-2018-09-15</p>
                                        <div class="action">执行人：你好12321223</div>
                                    </div>
                                </a>
                                <div class="address">活动地址：居然之家as sd sadsa sd阿萨德按时阿萨德</div>
                            </div>
                            <div class="hd-li">
                                <a href="javascript:void(0);" class="weui-media-box weui-media-box_appmsg">
                                    <div class="weui-media-box__bd iconfont icon-huodong">
                                        <h4 class="weui-media-box__title">水电费看见垃圾地方大型互动</h4>
                                        <p class="weui-media-box__desc time">2018-05-23-2018-09-15</p>
                                        <div class="action">执行人：你好12321223</div>
                                    </div>
                                </a>
                                <div class="address">活动地址：居然之家</div>
                            </div>
                            <div class="hd-li">
                                <a href="javascript:void(0);" class="weui-media-box weui-media-box_appmsg">
                                    <div class="weui-media-box__bd iconfont icon-huodong">
                                        <h4 class="weui-media-box__title">水电费看见垃圾地方大型互动</h4>
                                        <p class="weui-media-box__desc time">2018-05-23-2018-09-15</p>
                                        <div class="action">执行人：你好12321223</div>
                                    </div>
                                </a>
                                <div class="address">活动地址：居然之家as sd sadsa sd阿萨德按时阿萨德</div>
                            </div>
                            <div class="hd-li">
                                <a href="javascript:void(0);" class="weui-media-box weui-media-box_appmsg">
                                    <div class="weui-media-box__bd iconfont icon-huodong">
                                        <h4 class="weui-media-box__title">水电费看见垃圾地方大型互动</h4>
                                        <p class="weui-media-box__desc time">2018-05-23-2018-09-15</p>
                                        <div class="action">执行人：你好12321223</div>
                                    </div>
                                </a>
                                <div class="address">活动地址：居然之家</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="weui-loadmore">
                    <i class="weui-loading"></i>
                    <span class="weui-loadmore__tips">正在加载</span>
                </div>
                <div class="weui-nomore">
                    <span class="weui-loadmore__tips">没有更多数据了...</span>
                </div>
            </div>
            <div id="tab2" class="weui-tab__bd-item weui-pull-to-refresh infinite">
                <div class="weui-pull-to-refresh__layer">
                    <div class='weui-pull-to-refresh__arrow'></div>
                    <div class='weui-pull-to-refresh__preloader'></div>
                    <div class="down">下拉刷新</div>
                    <div class="up">释放刷新</div>
                    <div class="refresh">正在刷新</div>
                </div>
                <div class="content-padded">
                    <div class="weui-panel weui-panel_access">
                        <div class="weui-panel__bd">
                            <div class="hd-li">
                                <a href="javascript:void(0);" class="weui-media-box weui-media-box_appmsg">
                                    <div class="weui-media-box__bd iconfont icon-huodong">
                                        <h4 class="weui-media-box__title">水电费看见垃圾地方大型互动</h4>
                                        <p class="weui-media-box__desc time">2018-05-23-2018-09-15</p>
                                        <div class="action">执行人：你好12321223</div>
                                    </div>
                                </a>
                                <div class="address">活动地址：居然之家as sd sadsa sd阿萨德按时阿萨德</div>
                            </div>
                            <div class="hd-li">
                                <a href="javascript:void(0);" class="weui-media-box weui-media-box_appmsg">
                                    <div class="weui-media-box__bd iconfont icon-huodong">
                                        <h4 class="weui-media-box__title">水电费看见垃圾地方大型互动</h4>
                                        <p class="weui-media-box__desc time">2018-05-23-2018-09-15</p>
                                        <div class="action">执行人：你好12321223</div>
                                    </div>
                                </a>
                                <div class="address">活动地址：居然之家</div>
                            </div>
                            <div class="hd-li">
                                <a href="javascript:void(0);" class="weui-media-box weui-media-box_appmsg">
                                    <div class="weui-media-box__bd iconfont icon-huodong">
                                        <h4 class="weui-media-box__title">水电费看见垃圾地方大型互动</h4>
                                        <p class="weui-media-box__desc time">2018-05-23-2018-09-15</p>
                                        <div class="action">执行人：你好12321223</div>
                                    </div>
                                </a>
                                <div class="address">活动地址：居然之家as sd sadsa sd阿萨德按时阿萨德</div>
                            </div>
                            <div class="hd-li">
                                <a href="javascript:void(0);" class="weui-media-box weui-media-box_appmsg">
                                    <div class="weui-media-box__bd iconfont icon-huodong">
                                        <h4 class="weui-media-box__title">水电费看见垃圾地方大型互动</h4>
                                        <p class="weui-media-box__desc time">2018-05-23-2018-09-15</p>
                                        <div class="action">执行人：你好12321223</div>
                                    </div>
                                </a>
                                <div class="address">活动地址：居然之家</div>
                            </div>
                            <div class="hd-li">
                                <a href="javascript:void(0);" class="weui-media-box weui-media-box_appmsg">
                                    <div class="weui-media-box__bd iconfont icon-huodong">
                                        <h4 class="weui-media-box__title">水电费看见垃圾地方大型互动</h4>
                                        <p class="weui-media-box__desc time">2018-05-23-2018-09-15</p>
                                        <div class="action">执行人：你好12321223</div>
                                    </div>
                                </a>
                                <div class="address">活动地址：居然之家as sd sadsa sd阿萨德按时阿萨德</div>
                            </div>
                            <div class="hd-li">
                                <a href="javascript:void(0);" class="weui-media-box weui-media-box_appmsg">
                                    <div class="weui-media-box__bd iconfont icon-huodong">
                                        <h4 class="weui-media-box__title">水电费看见垃圾地方大型互动</h4>
                                        <p class="weui-media-box__desc time">2018-05-23-2018-09-15</p>
                                        <div class="action">执行人：你好12321223</div>
                                    </div>
                                </a>
                                <div class="address">活动地址：居然之家</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="weui-loadmore">
                    <i class="weui-loading"></i>
                    <span class="weui-loadmore__tips">正在加载</span>
                </div>
                <div class="weui-nomore">
                    <span class="weui-loadmore__tips">没有更多数据了...</span>
                </div>
            </div>
            <div id="tab3" class="weui-tab__bd-item weui-pull-to-refresh infinite">
                <div class="weui-pull-to-refresh__layer">
                    <div class='weui-pull-to-refresh__arrow'></div>
                    <div class='weui-pull-to-refresh__preloader'></div>
                    <div class="down">下拉刷新</div>
                    <div class="up">释放刷新</div>
                    <div class="refresh">正在刷新</div>
                </div>
                <div class="content-padded">
                    <div class="weui-panel weui-panel_access">
                        <div class="weui-panel__bd">
                            <div class="hd-li">
                                <a href="javascript:void(0);" class="weui-media-box weui-media-box_appmsg">
                                    <div class="weui-media-box__bd iconfont icon-huodong">
                                        <h4 class="weui-media-box__title">水电费看见垃圾地方大型互动</h4>
                                        <p class="weui-media-box__desc time">2018-05-23-2018-09-15</p>
                                        <div class="action">执行人：你好12321223</div>
                                    </div>
                                </a>
                                <div class="address">活动地址：居然之家as sd sadsa sd阿萨德按时阿萨德</div>
                            </div>
                            <div class="hd-li">
                                <a href="javascript:void(0);" class="weui-media-box weui-media-box_appmsg">
                                    <div class="weui-media-box__bd iconfont icon-huodong">
                                        <h4 class="weui-media-box__title">水电费看见垃圾地方大型互动</h4>
                                        <p class="weui-media-box__desc time">2018-05-23-2018-09-15</p>
                                        <div class="action">执行人：你好12321223</div>
                                    </div>
                                </a>
                                <div class="address">活动地址：居然之家</div>
                            </div>
                            <div class="hd-li">
                                <a href="javascript:void(0);" class="weui-media-box weui-media-box_appmsg">
                                    <div class="weui-media-box__bd iconfont icon-huodong">
                                        <h4 class="weui-media-box__title">水电费看见垃圾地方大型互动</h4>
                                        <p class="weui-media-box__desc time">2018-05-23-2018-09-15</p>
                                        <div class="action">执行人：你好12321223</div>
                                    </div>
                                </a>
                                <div class="address">活动地址：居然之家as sd sadsa sd阿萨德按时阿萨德</div>
                            </div>
                            <div class="hd-li">
                                <a href="javascript:void(0);" class="weui-media-box weui-media-box_appmsg">
                                    <div class="weui-media-box__bd iconfont icon-huodong">
                                        <h4 class="weui-media-box__title">水电费看见垃圾地方大型互动</h4>
                                        <p class="weui-media-box__desc time">2018-05-23-2018-09-15</p>
                                        <div class="action">执行人：你好12321223</div>
                                    </div>
                                </a>
                                <div class="address">活动地址：居然之家</div>
                            </div>
                            <div class="hd-li">
                                <a href="javascript:void(0);" class="weui-media-box weui-media-box_appmsg">
                                    <div class="weui-media-box__bd iconfont icon-huodong">
                                        <h4 class="weui-media-box__title">水电费看见垃圾地方大型互动</h4>
                                        <p class="weui-media-box__desc time">2018-05-23-2018-09-15</p>
                                        <div class="action">执行人：你好12321223</div>
                                    </div>
                                </a>
                                <div class="address">活动地址：居然之家as sd sadsa sd阿萨德按时阿萨德</div>
                            </div>
                            <div class="hd-li">
                                <a href="javascript:void(0);" class="weui-media-box weui-media-box_appmsg">
                                    <div class="weui-media-box__bd iconfont icon-huodong">
                                        <h4 class="weui-media-box__title">水电费看见垃圾地方大型互动</h4>
                                        <p class="weui-media-box__desc time">2018-05-23-2018-09-15</p>
                                        <div class="action">执行人：你好12321223</div>
                                    </div>
                                </a>
                                <div class="address">活动地址：居然之家</div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="weui-loadmore">
                    <i class="weui-loading"></i>
                    <span class="weui-loadmore__tips">正在加载</span>
                </div>
                <div class="weui-nomore">
                    <span class="weui-loadmore__tips">没有更多数据了...</span>
                </div>
            </div>
        </div>
        <div class="add-hd-bt-box">
            <a id="add-hd" href="./add-hd.html" class="weui-btn weui-btn_primary add-hd">添加活动</a>
        </div>
    </div>
</body>
<script src="./js/jquery-2.1.4.js"></script>
<script src="./js/fastclick.js"></script>
<script>
    $(function() {
        FastClick.attach(document.body);
    });
</script>
<script src="./js/jquery-weui.js"></script>

<script>
    // 初始页面
    var page1 = 2,
        page2 = 2,
        page3 = 2;
    $('.weui-tab__bd-item').pullToRefresh().on('pull-to-refresh', function(done) {
        var self = this
            // type类型（1全部，2进行中，3已结束）
        var type = this.id == 'tab1' ? 1 : (this.id == 'tab2' ? 2 : (this.id == 'tab3' ? 3 : 1))
        console.log(type)
            // 此处模仿数据刷新,所有计时器只是用于异步获取数据，接口地址为真实的时候可以去掉计时器
        $(self).find('.weui-nomore').css('display', 'none');
        $.ajax({
            url: 'http://172.30.1.115/kpi-mb/hd-index.html',
            data: {
                page: 1,
                type: type
            },
            // dataType: 'json',
            success: (d) => {
                // 具体提示信息由后台提供
                setTimeout(() => {
                    if (true) {
                        // 此处替换数据
                        setTimeout(function() {
                            $(self).pullToRefreshDone();
                        }, 1000)
                        self.loadnomore = false;
                        self.id == 'tab1' ? page1 = 2 : (this.id == 'tab2' ? page2 = 2 : (this.id == 'tab3' ? page3 = 2 : page1 = 2))
                    } else if (false) {
                        // 没有更多数据
                        $(self).find('.weui-nomore').css('display', 'block');
                        self.loadnomore = true;
                        setTimeout(function() {
                            $(self).pullToRefreshDone();
                        }, 1000)
                    } else {
                        self.loadnomore = false;
                        $.toast('加载数据失败', 'text');
                        setTimeout(function() {
                            $(self).pullToRefreshDone();
                        }, 1000)
                    }
                }, 1500);
            },
            error: () => {
                self.loadnomore = false;
                $.toast('服务器异常', 'text');
                setTimeout(function() {
                    $(self).pullToRefreshDone();
                }, 2000)
            }
        })
    })
    $(".infinite").infinite().on("infinite", function() {
        var self = this;
        // type类型（1全部，2进行中，3已结束）
        var type = this.id == 'tab1' ? 1 : (this.id == 'tab2' ? 2 : (this.id == 'tab3' ? 3 : 1))
            // console.log(type)
            // 此处防止多次滚动加载数据
        if (self.loading || self.loadnomore) return;
        // console.log(self)
        self.loading = true;
        //加载数据
        $(this).find('.weui-loadmore').css('display', 'block');
        var page = this.id == 'tab1' ? page1 : (this.id == 'tab2' ? page2 : (this.id == 'tab3' ? page3 : page1))
        $.ajax({
            url: 'http://172.30.1.115/kpi-mb/hd-index.html',
            data: {
                page: page,
                type: type
            },
            success: (d) => {
                // 具体提示信息由后台提供
                setTimeout(() => {
                    if (false) {
                        // 此处替换数据
                        var html = `
                        <div class="hd-li">
                                <a href="javascript:void(0);" class="weui-media-box weui-media-box_appmsg">
                                    <div class="weui-media-box__bd iconfont icon-huodong">
                                        <h4 class="weui-media-box__title">水电费看见垃圾地方大型互动</h4>
                                        <p class="weui-media-box__desc time">2018-05-23-2018-09-15</p>
                                        <div class="action">执行人：你好12321223</div>
                                    </div>
                                </a>
                                <div class="address">活动地址：居然之家as sd sadsa sd阿萨德按时阿萨德</div>
                            </div>
                            <div class="hd-li">
                                <a href="javascript:void(0);" class="weui-media-box weui-media-box_appmsg">
                                    <div class="weui-media-box__bd iconfont icon-huodong">
                                        <h4 class="weui-media-box__title">水电费看见垃圾地方大型互动</h4>
                                        <p class="weui-media-box__desc time">2018-05-23-2018-09-15</p>
                                        <div class="action">执行人：你好12321223</div>
                                    </div>
                                </a>
                                <div class="address">活动地址：居然之家</div>
                            </div>
                        `;
                        setTimeout(function() {
                            $(self).find(".weui-panel__bd").append(html);
                            $(self).find('.weui-loadmore').css('display', 'none');
                            self.loading = false;
                            console.log(page)
                            self.id == 'tab1' ? page1++ : (self.id == 'tab2' ? page2++ : (self.id == 'tab3' ? page3++ : page1++));
                        }, 2000); //模拟延迟
                    } else if (true) {
                        // 没有更多数据了
                        $(self).find('.weui-loadmore').css('display', 'none');
                        $(self).find('.weui-nomore').css('display', 'block');
                        self.loading = false;
                        self.loadnomore = true;
                    } else {
                        $.toast('加载数据失败', 'text');
                        $(self).find('.weui-loadmore').css('display', 'none');
                        self.loading = false;
                    }
                }, 1500);
            },
            error: () => {
                $.toast('服务器异常', 'text');
                $(self).find('.weui-loadmore').css('display', 'none');
                self.loading = false;
            }
        })
    });
</script>

</html>